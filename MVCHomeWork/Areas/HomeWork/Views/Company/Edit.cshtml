@model MVCHomeWork.Areas.HomeWork.Models.Company

@if (Model != null)
{
    <div class="col-md-12 content">
        <div class="panel panel-default" style="margin-top: 10px;">
            <div class="panel-heading">
                <h4>@(ViewBag.isEdit ? (Model.Id == 0 ? "新增" : "編輯") : "")客戶資料</h4>
                <div class="pull-right" style="margin-top: -37px;">
                    <button type="button" class="btn btn-default" onclick="$('.formError').remove(); Backtrack();">回清單</button>
                    @if (ViewBag.isEdit)
                    {
                        <button type="button" class="btn btn-primary" onclick="$('#formEdit').submit();">儲存</button>
                        if (Model.Id != 0)
                        {
                            <button type="button" class="btn btn-danger" onclick="delCompanyData('@Model.Id', '@Model.CompanyName')">刪除</button>
                        }
                    }
                </div>
            </div>
            <div class="panel-body">
                @if (ViewBag.isEdit)
                {
                    using (Html.BeginForm(null, null, FormMethod.Post, new { id = "formEdit", autocomplete = "off" }))
                    {
                        @Html.HiddenFor(p => p.Id, new { id = "hidKey" })
                        @Html.HiddenFor(p => p.IsDelete)
                        <ul class="inline">
                            <li class="li-xlarge">
                                @Html.LabelFor(p => p.CompanyName)
                                @Html.TextBoxFor(p => p.CompanyName)
                            </li>
                            <li class="li-medium">
                                @Html.LabelFor(p => p.CompanyNo)
                                @Html.TextBoxFor(p => p.CompanyNo)
                            </li>
                            <li class="li-medium">
                                @Html.LabelFor(p => p.Tel)
                                @Html.TextBoxFor(p => p.Tel)
                            </li>
                            <li class="li-medium">
                                @Html.LabelFor(p => p.Fax)
                                @Html.TextBoxFor(p => p.Fax)
                            </li>
                            <li class="li-xxlarge">
                                @Html.LabelFor(p => p.Address)
                                @Html.TextBoxFor(p => p.Address)
                            </li>
                            <li class="li-xxlarge">
                                @Html.LabelFor(p => p.Email)
                                @Html.TextBoxFor(p => p.Email)
                            </li>
                        </ul>
                    }
                }
                else
                {
                    <ul class="inline">
                        <li class="li-xlarge">
                            @Html.LabelFor(p => p.CompanyName)
                            @Html.DisplayFor(p => p.CompanyName)
                        </li>
                        <li class="li-medium">
                            @Html.LabelFor(p => p.CompanyNo)
                            @Html.DisplayFor(p => p.CompanyNo)
                        </li>
                        <li class="li-medium">
                            @Html.LabelFor(p => p.Tel)
                            @Html.DisplayFor(p => p.Tel)
                        </li>
                        <li class="li-medium">
                            @Html.LabelFor(p => p.Fax)
                            @Html.DisplayFor(p => p.Fax)
                        </li>
                        <li class="li-xxlarge">
                            @Html.LabelFor(p => p.Address)
                            @Html.DisplayFor(p => p.Address)
                        </li>
                        <li class="li-xxlarge">
                            @Html.LabelFor(p => p.Email)
                            @Html.DisplayFor(p => p.Email)
                        </li>
                    </ul>
                }
            </div>
        </div>
        <div id="SubList" class="panel panel-default" style="margin-top: -15px;">
            <div class="panel-heading">
                <h4 id="SubListTitle"></h4>
            </div>
            <div id="SubListView" class="panel-body"></div>
        </div>
    </div>
    
    <script type="text/javascript">
        $(document).ready(function () {
            $("#SubList").hide();

            @if (ViewBag.isEdit)
            {<text>
            $.validator.unobtrusive.parse("#formEdit");
            $("#formEdit").makeValidationInline();
            $("#formEdit").submit(function (e) {
                e.preventDefault();
                if ($("#formEdit").validate().valid()) {
                    BlockUIWindow("...客戶資料儲存中...");
                    $.ajax({
                        url: "@Url.Action("Save", "Company")",
                        type: 'POST',
                        data: $("#formEdit").serialize(),
                        success: function (data) {
                            alert(data.message);
                            if (data.isValid) {
                                @if (Model.Id == 0)
                                {<text>
                                $("#hidKey").val(data.id);
                                </text>}
                            }
                            $.unblockUI();
                        }
                    });
                }
            });
            </text>}
        });
    </script>
}
else
{
    <div class="col-md-12 content">
        <div class="panel panel-default" style="margin-top: 10px;">
            <div class="panel-heading">
                <div class="pull-right" style="margin-top: -37px;">
                    <button type="button" class="btn btn-default" onclick="Backtrack();">回清單</button>
                </div>
            </div>
            <div class="panel-body">
                <h4 class="modal-title" style="color:red;">"客戶資料不存在</h4>
            </div>
        </div>
    </div>
}